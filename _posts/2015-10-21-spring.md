---
layout: post
title: "Spring"
date: 2015-10-21 14:41:25
description: "Spring"
categories:
- Spring
permalink: spring
---

#### Spring 自定义注解

> Annotation不支持继承其他接口  
  Annotation支持三种类型：基本类型、数组类型、枚举类型  
  
> `default`关键字，设置默认值  
  `value`属性关键字，当且仅有一个属性时，使用时可省略

```java
/**
 * 名    称：OperateType
 * 功    能：
 * 创 建 人：K.K
 * 创建时间：2015/10/21 13:51
 * 修 改 人：
 * 修改时间：
 * 说    明：
 * 版 本 号：
 */
public enum OperateType {
    NIL(0),
    GET(1),
    ADD(2),
    UPDATE(3),
    DELETE(4);

    private int value;

    private OperateType(int value) {
        this.value = value;
    }

    @Override
    public String toString() {
        return String.valueOf(this.value);
    }
}
```

```java
import java.lang.annotation.*;

/**
 * 名    称：Operation
 * 功    能：
 * 创 建 人：K.K
 * 创建时间：2015/10/21 13:16
 * 修 改 人：
 * 修改时间：
 * 说    明：
 * 版 本 号：
 */
@Target({ElementType.METHOD})
@Retention(RetentionPolicy.RUNTIME)
@Documented
@Inherited
public @interface Operation {
    String description() default "";

    OperateType type() default OperateType.NIL;

    String[] params() default {};
}
```

> `@Target` 描述注解的使用范围  
  * CONSTRUCTOR 构造器  
  * FIFLD 域  
  * LOCAL_VARIABLE 局部变量  
  * `METHOD` 方法  
  * PACKAGE 包  
  * PARAMETER 参数  
  * TYPE 类或接口  
    
> `@Retention` 注解的生命周期  
  * SOURCE 在源文件中有效  
  * CLASS 在class文件中有效  
  * `RUNTIME` 在运行时有效  
  

> `@Documented` 允许javadoc将Annotation生成到doc  

> `@Inherited` 允许子类继承Annotation标记

#### Spring获取ApplicationContext对象  
> 1.FileSystemXmlApplicationContext  

```vim
// 重新加载配置文件
ApplicationContext ctx = new FileSystemXmlApplicationContext(...);
```  

> 2.ClassPathXmlApplicationContext  

```vim
ApplicationContext ctx = new ClassPathXmlApplication(...);
```

> 3.WebApplicationContextUtils  

```vim
ServletContext servletContext = request.getSession().getServletContext();      
ApplicationContext ctx = WebApplicationContextUtils.getWebApplicationContext(servletContext); 
```
> 4.创建一个类让其实现org.springframework.context.ApplicationContextAware接口来让Spring在启动的时候为我们注入ApplicationContext对象  

>Spring中提供一些Aware相关的接口，BeanFactoryAware、 ApplicationContextAware、ResourceLoaderAware、ServletContextAware等等，其中最常用到的是ApplicationContextAware。实现ApplicationContextAware的Bean，在Bean被初始后，将会被注入ApplicationContext的实例。ApplicationContextAware提供了publishEvent()方法，实现Observer(观察者)设计模式的事件传播机，提供了针对Bean的事件传播功能。通过Application.publishEvent方法，我们可以将事件通知系统内所有的ApplicationListener。  

>Spring事件处理一般过程：  

>定义Event类，继承org.springframework.context.ApplicationEvent。  

>编写发布事件类Publisher，实现org.springframework.context.ApplicationContextAware接口。  

>覆盖方法setApplicationContext(ApplicationContext applicationContext)和发布方法publish(Object obj)。  
>定义时间监听类EventListener，实现ApplicationListener接口，实现方法onApplicationEvent(ApplicationEvent event)。  


```vim
@Component
@Lazy(false)
public class Loading implements ApplicationContextAware {
    private static ApplicationContext applicationContext;
    @Override
    public void setApplicationContext(ApplicationContext applicationContext) throws BeansException {
        this.applicationContext = applicationContext;
    }
}
```
