---
layout: post
title: "Tomcat"
date: 2015-10-14 14:32:48
description: "Tomcat"
categories:
- Tomcat
permalink: tomcat
---

#### Tomcat相关端口
> 端口：8005 主要负责启动关闭  
        8008 主要负责通过AJP均衡，常用于Apache与Tomcat整合  
        8080 WEB访问，常用于Nginx与Tomcat整合

```vim
// 1.在tomcat安装目录的conf目录下的server.xml文件中，以下内容中的port属性指定了默认端口
<Connector connectionTimeout="20000" port="8080" protocol="HTTP/1.1" redirectPort="8443"/>

// 2.默认的根目录是tomcat7\webapps\ROOT，我们可以在tomcat\conf\server.xml文件Host标签中指定根目录和其他目录
//   根据上面的配置，我们访问http://127.0.0.1/aaa时候，使用F:\aaa目录中的web程序，bbb同理。
<Host appBase="webapps" autoDeploy="true" name="localhost" unpackWARs="true">
        <Context docBase="F:\aaa" path="/aaa" reloadable="true"/>
        <Context docBase="F:\bbb" path="/bbb" debug="0" reloadable="true" crossContext="true" />
</Host>

// 3.三种设置根目录的方法
// 第一种方法： 
// 打开tomcat\conf\server.xml文件，在Host标签之间加入代码
<Context docBase="F:\aaa" path="" debug="0"  reloadable="true"/> 

// 第二种方法： 
// 在tomcat默认安装后，tomcat的主目录是webapps/ROOT目录，将war包解压后的文件全部拷进去即可。 

// 第三种方法： 
// tomcat5.0以下版本在tomcat/conf/Catalina/localhost目录下会自动生成了一个ROOT.Xml， 
// 但是5.0以上版本不再生成此文件，所以可以新建个ROOT.xml,在里面加入如下代码： 
<?Xml version='1.0' encoding='utf-8'?> 
  <Context crossContext="true" docBase="F:\aaa" path="" reloadable="true"/>
```

#### Tomcat实现多域名之间Session共享
问题：  
启用二级域名后，面临一个主域名与二级域名之间Session不能共享的问题。  
因为Tomcat下，JSESSIONID（Cookie）的path是默认没有限制的，访问不同的二级域名，Cookie就重新生成，那么Session也会不一样。  
解决方案：  
1.在项目的/MET-INF/目录下创建一个context.xml文件  

```vim
<Context ... sessionCookiePath="/">...</Content>
```  

2.Tomcat的server.xml文件  

```vim
<Context ... sessionCookiePath="/">...</Content>
```  

当然也可以配置域名、Http只读  

```vim
<Context ... useHttpOnly="true" sessionCookiePath="/" sessionCookieDomain=".XXXX.com">...</Content>
```
